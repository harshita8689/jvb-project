<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Our Products ‚Äì Jain Vastar Bhandar</title>
    <link rel="stylesheet" href="products.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <header class="horizontal-navbar">
      <div class="logo-text">
        <img
          src="/images/logo.png"
          alt="JVB Logo"
          style="width: 60px; height: 60px"
        />
      </div>

      <ul class="nav-menu">
        <li class="active">
          <a href="index.html"><i class="fas fa-home"></i> Home</a>
        </li>
        <li>
          <a href="products.html"><i class="fas fa-th"></i> Products</a>
        </li>
        <li>
          <a href="cart.html"><i class="fas fa-shopping-cart"></i> Cart</a>
        </li>
      </ul>

      <div class="controls">
        <input
          type="text"
          id="searchInput"
          placeholder="Search products..."
          oninput="filterProducts()"
        />
        <select id="fabricFilter" onchange="filterProducts()">
          <option value="">All Fabrics</option>
          <option value="Cotton">Cotton</option>
          <option value="Silk">Silk</option>
          <option value="Rayon">Rayon</option>
        </select>
      </div>
    </header>

    <div style="text-align: center; margin: 1.5rem">
      <h1>JAIN VASTAR BHANDAR</h1>
      <p class="tagline">-‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø ‡§∏‡•á ‡§∏‡§ú‡•á ‡§π‡§∞ ‡§µ‡§∏‡•ç‡§§‡•ç‡§∞ üëëü™î</p>
      <h2>Our Products</h2>
    </div>

    <main>
      <div id="products-container" class="products">
        <p>Loading products...</p>
      </div>
    </main>

    <script>
      // ‚úÖ Auto detect local vs deployed
      const BASE_URL = window.location.hostname.includes("localhost")
        ? "http://localhost:3001"
        : "https://YOUR_BACKEND_LIVE_URL_HERE";

      const productsContainer = document.getElementById("products-container");
      const searchInput = document.getElementById("searchInput");
      const fabricFilter = document.getElementById("fabricFilter");

      function displayProducts(products) {
        productsContainer.innerHTML = "";

        if (!products || products.length === 0) {
          productsContainer.innerHTML = "<p>No products found.</p>";
          return;
        }

        products.forEach((product) => {
          const priceAsNumber = parseFloat(product.price);

          const imgSrc = product.image_url.startsWith("/")
            ? product.image_url
            : "/" + product.image_url;

          const productHtml = `
            <a href="product-detail.html?id=${product.id}" class="product-link" style="text-decoration:none;color:inherit;">
              <div class="product">
                <img src="${imgSrc}" alt="${product.name}" />
                <div class="product-info">
                  <h3>${product.name}</h3>
                  <p class="description">${product.description}</p>
                  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:auto;">
                    <p class="price">‚Çπ${priceAsNumber.toFixed(2)}</p>
                    <button onclick='event.preventDefault(); addToCart(${JSON.stringify(
                      product
                    )})'>Add to Cart</button>
                  </div>
                </div>
              </div>
            </a>
          `;

          productsContainer.innerHTML += productHtml;
        });
      }

      async function fetchAndFilterProducts() {
        const searchText = searchInput.value.trim();
        const fabric = fabricFilter.value;

        try {
          const response = await fetch(
            `${BASE_URL}/api/products?search=${encodeURIComponent(
              searchText
            )}&fabric=${encodeURIComponent(fabric)}`
          );

          const filteredProducts = await response.json();
          displayProducts(filteredProducts);
        } catch (err) {
          console.error("Fetch error:", err);
          productsContainer.innerHTML =
            "<p>Error fetching products. Backend URL is not working.</p>";
        }
      }

      function filterProducts() {
        fetchAndFilterProducts();
      }

      function addToCart(product) {
        let cart = JSON.parse(localStorage.getItem("cartItems")) || [];
        let existing = cart.find((item) => item.id === product.id);

        if (existing) existing.quantity += 1;
        else cart.push({ ...product, quantity: 1 });

        localStorage.setItem("cartItems", JSON.stringify(cart));
        alert(`${product.name} added to cart!`);
      }

      document.addEventListener("DOMContentLoaded", fetchAndFilterProducts);
    </script>
  </body>
</html>
<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const productsContainer = document.getElementById("products-container");

    // ‚úÖ Local pe localhost chalega
    // ‚úÖ Netlify pe backend ka live link lagega
    const API_URL = window.location.hostname.includes("localhost")
      ? "http://localhost:3001"
      : "PASTE_YOUR_BACKEND_URL_HERE"; // ‚úÖ yaha apna backend deploy url

    try {
      const response = await fetch(`${API_URL}/api/products`);
      const products = await response.json();

      productsContainer.innerHTML = ""; // Clear loading message

      products.forEach((product) => {
        const priceAsNumber = parseFloat(product.price);

        // ‚úÖ image path fix (images/p1.png -> /images/p1.png)
        const imgSrc = product.image_url.startsWith("/")
          ? product.image_url
          : "/" + product.image_url;

        const productHtml = `
          <a href="product-detail.html?id=${product.id}" class="product-link">
            <div class="product">
              <img src="${imgSrc}" alt="${product.name}" />
              <div class="product-info">
                <h3>${product.name}</h3>
                <div>
                  <p class="price">‚Çπ${priceAsNumber.toFixed(2)}</p>
                  <button onclick='event.preventDefault(); addToCart(${JSON.stringify(
                    product
                  )})'>Add to Cart</button>
                </div>
              </div>
            </div>
          </a>
        `;

        productsContainer.innerHTML += productHtml;
      });
    } catch (error) {
      console.error("Failed to fetch products:", error);
      productsContainer.innerHTML =
        "<p>Error loading products. Please try again.</p>";
    }
  });

  function addToCart(product) {
    let cart = JSON.parse(localStorage.getItem("cartItems")) || [];
    let existing = cart.find((item) => item.id === product.id);

    if (existing) {
      existing.quantity += 1;
    } else {
      cart.push({ ...product, quantity: 1 });
    }

    localStorage.setItem("cartItems", JSON.stringify(cart));
    alert(product.name + " has been added to your cart!");
  }
</script>




