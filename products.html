
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Our Products ‚Äì Jain Vastar Bhandar</title>
    <link rel="stylesheet" href="products.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <h1>Our Products</h1>
    <a href="index.html" class="home">&larr; Back to Home</a>
    <header>
      <div class="announcement-wrapper">
        <div class="announcement-slider">
          <div>üéâ AVAIL 10% OFF on First Order - Use Code <b>AVAIL10</b></div>
          <div>üßµ New GANGA Premium Suits Just Launched!</div>
          <div>üìû Call Now: +91-94169-50256 | +91-70153-44280</div>
          <div>üìç Visit us at Railway Road, Gharaunda</div>
        </div>
      </div>

      <div class="header-container">
        <div class="logo-text">
          <img src="images/logo.png" alt="Logo" />
        </div>
        <div class="head">
          <h1>Jain Vastar Bhandar</h1>
          <p class="tagline">‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø ‡§∏‡•á ‡§∏‡§ú‡•á ‡§π‡§∞ ‡§µ‡§∏‡•ç‡§§‡•ç‡§∞ üëëü™î</p>
        </div>
        
        <div class="controls">
          <input
            type="text"
            id="searchInput"
            placeholder="Search products..."
            oninput="filterProducts()"
          />
          <select id="fabricFilter" onchange="filterProducts()">
            <option value="">All Fabrics</option>
            <option value="Cotton">Cotton</option>
            <option value="Silk">Silk</option>
            <option value="Rayon">Rayon</option>
          </select>
        </div>
      </div>
      
      <nav class="horizontal-navbar">
        <ul class="nav-menu">
          <li class="active">
            <a href="index.html" title="Home"
              ><i class="fas fa-home"></i> Home</a
            >
          </li>
          <h1>Our Products</h1>
          <a href="index.html" class="home">&larr; Back to Home</a>
          <li>
            <a href="cart.html" title="Cart"
              ><i class="fas fa-shopping-cart"></i> Cart</a
            >
          </li>
          <li>
            <a href="#new" title="New Arrivals"
              ><i class="fas fa-star"></i> New Arrivals</a
            >
          </li>
          <li>
            <a href="#why-choose-us" title="Why Us"
              ><i class="fas fa-question-circle"></i> Why Us</a
            >
          </li>
          <li>
            <a href="#testimonials" title="Testimonials"
              ><i class="fas fa-comment-dots"></i> Testimonials</a
            >
          </li>
          <li>
            <a href="#contact" title="Contact"
              ><i class="fas fa-envelope"></i> Contact</a
            >
          </li>
          <li>
            <a href="#message" title="Message Us"
              ><i class="fas fa-paper-plane"></i> Message</a
            >
          </li>
        </ul>
      </nav>
    </header>

    <main>
      <div class="section">
        <div id="products-container" class="products">
          <p>Loading products...</p>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const productsContainer = document.getElementById("products-container");
        try {
          const response = await fetch("http://localhost:3001/api/products");
          const products = await response.json();

          productsContainer.innerHTML = ""; // Clear loading message

          products.forEach((product) => {
            // FIX: Convert the price string to a number before formatting
            const priceAsNumber = parseFloat(product.price);

            const productHtml = `
                        <a href="product-detail.html?id=${
                          product.id
                        }" class="product-link">
                            <div class="product">
                                <img src="${product.image_url}" alt="${
              product.name
            }" />
                                <div class="product-info">
                                    <h3>${product.name}</h3>
                                    <div>
                                        <p class="price">‚Çπ${priceAsNumber.toFixed(
                                          2
                                        )}</p>
                                        <button onclick="event.preventDefault(); addToCart(${JSON.stringify(
                                          product
                                        )})">Add to Cart</button>
                                    </div>
                                </div>
                            </div>
                        </a>
                    `;
            productsContainer.innerHTML += productHtml;
          });
        } catch (error) {
          console.error("Failed to fetch products:", error);
          productsContainer.innerHTML =
            "<p>Error loading products. Please try again.</p>";
        }
      });

      function addToCart(product) {
        let cart = JSON.parse(localStorage.getItem("cartItems")) || [];
        let existing = cart.find((item) => item.id === product.id);
        if (existing) {
          existing.quantity += 1;
        } else {
          cart.push({ ...product, quantity: 1 });
        }
        localStorage.setItem("cartItems", JSON.stringify(cart));
        alert(product.name + " has been added to your cart!");
      }
    </script>
    <style>
      a.product-link {
        text-decoration: none;
        color: inherit;
        display: flex;
      }
    </style>
  </body>
</html> -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Our Products ‚Äì Jain Vastar Bhandar</title>
    <link rel="stylesheet" href="products.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Navbar -->
    <header class="horizontal-navbar">
      <div class="logo-text">
        <img
          src="images/logo.png"
          alt="JVB Logo"
          style="width: 60px; height: 60px"
        />
      </div>
      <ul class="nav-menu">
        <li class="active">
          <a href="index.html"><i class="fas fa-home"></i> Home</a>
        </li>
        <li>
          <a href="products.html"><i class="fas fa-th"></i> Products</a>
        </li>
        <li>
          <a href="cart.html"><i class="fas fa-shopping-cart"></i> Cart</a>
        </li>
        <li>
          <a href="#contact"><i class="fas fa-envelope"></i> Contact</a>
        </li>
      </ul>
      <div class="controls">
        <input
          type="text"
          id="searchInput"
          placeholder="Search products..."
          oninput="filterProducts()"
        />
        <select id="fabricFilter" onchange="filterProducts()">
          <option value="">All Fabrics</option>
          <option value="Cotton">Cotton</option>
          <option value="Silk">Silk</option>
          <option value="Rayon">Rayon</option>
        </select>
      </div>
    </header>

    <!-- Page Title -->
    <div style="text-align: center; margin: 1.5rem">
      <h1>JAIN VASTAR BHANDAR</h1>
      <p class="tagline">-‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø ‡§∏‡•á ‡§∏‡§ú‡•á ‡§π‡§∞ ‡§µ‡§∏‡•ç‡§§‡•ç‡§∞ üëëü™î</p>
      <h1>Our Products</h1>
    </div>

    <!-- Products Container -->
    <main>
      <div id="products-container" class="products">
        <p>Loading products...</p>
      </div>
    </main>

    <script>
      const productsContainer = document.getElementById("products-container");
      const searchInput = document.getElementById("searchInput");
      const fabricFilter = document.getElementById("fabricFilter");
      let allProducts = []; // To store the original list

      // This function displays the products on the page
      function displayProducts(products) {
        productsContainer.innerHTML = ""; // Clear previous products

        if (!products || products.length === 0) {
          productsContainer.innerHTML = "<p>No products found.</p>";
          return;
        }

        products.forEach((product) => {
          const priceAsNumber = parseFloat(product.price);
          const productHtml = `
        <a href="product-detail.html?id=${
          product.id
        }" class="product-link" style="text-decoration: none; color: inherit;">
            <div class="product">
                <img src="${product.image_url}" alt="${product.name}" />
                <div class="product-info">
                    <h3>${product.name}</h3>
                    <p class="description">${product.description}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                      <p class="price">‚Çπ${priceAsNumber.toFixed(2)}</p>
                      <button onclick="event.preventDefault(); addToCart(${JSON.stringify(
                        product
                      )})">Add to Cart</button>
                    </div>
                </div>
            </div>
        </a>
      `;
          productsContainer.innerHTML += productHtml;
        });
      }

      // This function fetches products based on current filters
      async function fetchAndFilterProducts() {
        const searchText = searchInput.value.trim();
        const fabric = fabricFilter.value;

        try {
          // Fetch from the server with search and fabric queries
          const response = await fetch(
            `http://localhost:3001/api/products?search=${encodeURIComponent(
              searchText
            )}&fabric=${encodeURIComponent(fabric)}`
          );
          const filteredProducts = await response.json();
          displayProducts(filteredProducts);
        } catch (err) {
          console.error(err);
          productsContainer.innerHTML = "<p>Error fetching products.</p>";
        }
      }

      // We are renaming your old filterProducts to avoid confusion
      // The oninput and onchange attributes in your HTML should call this function.
      function filterProducts() {
        fetchAndFilterProducts();
      }

      // This is the addToCart function
      function addToCart(product) {
        let cart = JSON.parse(localStorage.getItem("cartItems")) || [];
        let existing = cart.find((item) => item.id === product.id);
        if (existing) {
          existing.quantity += 1;
        } else {
          cart.push({ ...product, quantity: 1, image: product.image_url }); // Ensure image is passed for cart
        }
        localStorage.setItem("cartItems", JSON.stringify(cart));
        alert(`${product.name} has been added to your cart!`);
      }

      // Load products when the page is ready
      document.addEventListener("DOMContentLoaded", () => {
        // Check if a search query came from the homepage URL
        const params = new URLSearchParams(window.location.search);
        const searchQuery = params.get("search");
        if (searchQuery) {
          searchInput.value = searchQuery; // Put the search term in the box
        }

        // Fetch initial products
        fetchAndFilterProducts();
      });
    </script>
  </body>
</html>


